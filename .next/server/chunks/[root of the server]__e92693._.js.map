{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 159, "column": 0}, "map": {"version":3,"sources":["file:///Users/marcmoller/Documents/GitHub/hhservice/src/app/%28dashboard%29/admin/settings/uploads/route.ts"],"sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { IncomingForm, File } from \"formidable\";\nimport { promisify } from \"util\";\nimport { IncomingMessage } from \"http\";\nimport { Readable } from \"stream\";\n\nexport const config = { api: { bodyParser: false } };\n\nasync function isAdmin(req: NextRequest) {\n  const authHeader = req.headers.get(\"Authorization\");\n  return authHeader === \"Bearer SECRET_ADMIN_KEY\";\n}\n\nexport async function POST(req: NextRequest) {\n  if (!(await isAdmin(req))) {\n    return NextResponse.json({ message: \"Ikke autoriseret\" }, { status: 403 });\n  }\n\n  try {\n    const form = new IncomingForm();\n    const uploadDir = path.join(process.cwd(), \"public\");\n    const parseForm = promisify(form.parse.bind(form));\n\n    const stream = new Readable();\n    stream._read = () => {};\n    const arrayBuffer = await req.arrayBuffer();\n    stream.push(Buffer.from(arrayBuffer));\n    stream.push(null);\n\n    const { files } = await parseForm(stream as unknown as IncomingMessage);\n\n    if (!files || !(files as any).file) {\n      return NextResponse.json(\n        { message: \"Ingen fil fundet\" },\n        { status: 400 }\n      );\n    }\n\n    const file = Array.isArray((files as any).file)\n      ? (files as any).file[0]\n      : (files as any).file;\n    const oldPath = file.filepath;\n    const fileName = \"hero.png\";\n    const newPath = path.join(uploadDir, fileName);\n\n    await fs.promises.rename(oldPath, newPath);\n\n    return NextResponse.json({\n      message: \"Fil uploadet!\",\n      filePath: `/public/${fileName}`,\n    });\n  } catch (error) {\n    return NextResponse.json(\n      { message: \"Fejl ved upload\", error: (error as Error).toString() },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AAEA;AAHA;;;;;;;AAKO,MAAM,SAAS;IAAE,KAAK;QAAE,YAAY;IAAM;AAAE;AAEnD,eAAe,QAAQ,GAAgB;IACrC,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;IACnC,OAAO,eAAe;AACxB;AAEO,eAAe,KAAK,GAAgB;IACzC,IAAI,CAAE,MAAM,QAAQ,MAAO;QACzB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAmB,GAAG;YAAE,QAAQ;QAAI;IAC1E;IAEA,IAAI;QACF,MAAM,OAAO,IAAI,4LAAA,CAAA,eAAY;QAC7B,MAAM,YAAY,iGAAA,CAAA,UAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI;QAC3C,MAAM,YAAY,CAAA,GAAA,iGAAA,CAAA,YAAS,AAAD,EAAE,KAAK,KAAK,CAAC,IAAI,CAAC;QAE5C,MAAM,SAAS,IAAI,qGAAA,CAAA,WAAQ;QAC3B,OAAO,KAAK,GAAG,KAAO;QACtB,MAAM,cAAc,MAAM,IAAI,WAAW;QACzC,OAAO,IAAI,CAAC,OAAO,IAAI,CAAC;QACxB,OAAO,IAAI,CAAC;QAEZ,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,UAAU;QAElC,IAAI,CAAC,SAAS,CAAC,AAAC,MAAc,IAAI,EAAE;YAClC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAmB,GAC9B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,MAAM,OAAO,CAAC,AAAC,MAAc,IAAI,IAC1C,AAAC,MAAc,IAAI,CAAC,EAAE,GACtB,AAAC,MAAc,IAAI;QACvB,MAAM,UAAU,KAAK,QAAQ;QAC7B,MAAM,WAAW;QACjB,MAAM,UAAU,iGAAA,CAAA,UAAI,CAAC,IAAI,CAAC,WAAW;QAErC,MAAM,6FAAA,CAAA,UAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,SAAS;QAElC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,UAAU,CAAC,QAAQ,EAAE,UAAU;QACjC;IACF,EAAE,OAAO,OAAO;QACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAmB,OAAO,AAAC,MAAgB,QAAQ;QAAG,GACjE;YAAE,QAAQ;QAAI;IAElB;AACF"}},
    {"offset": {"line": 228, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}