{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///Users/marcmoller/Documents/GitHub/hhservice/src/app/%28dashboard%29/admin/settings/uploads/route.ts"],"sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport { IncomingForm, File, Fields, Files } from \"formidable\";\nimport { Readable } from \"stream\";\nimport { IncomingMessage } from \"http\";\n\n// Ensure Next.js does NOT parse the body automatically\nexport const config = { api: { bodyParser: false } };\n\n// Helper function to check if user is an admin\nasync function isAdmin(req: NextRequest) {\n  const authHeader = req.headers.get(\"Authorization\");\n  return authHeader === \"Bearer SECRET_ADMIN_KEY\"; // Replace with real authentication\n}\n\n// Helper function to convert NextRequest into an IncomingMessage-like object\nasync function convertNextRequestToIncomingMessage(\n  req: NextRequest\n): Promise<IncomingMessage> {\n  const arrayBuffer = await req.arrayBuffer();\n  const buffer = Buffer.from(arrayBuffer);\n  const stream = new Readable();\n  stream.push(buffer);\n  stream.push(null);\n\n  return Object.assign(stream, {\n    headers: Object.fromEntries(req.headers.entries()),\n    method: req.method,\n    url: req.url,\n  }) as IncomingMessage;\n}\n\n// Handle file upload\nexport async function POST(req: NextRequest) {\n  if (!(await isAdmin(req))) {\n    return NextResponse.json({ message: \"Unauthorized\" }, { status: 403 });\n  }\n\n  try {\n    // Create a new instance of IncomingForm\n    const form = new IncomingForm({\n      multiples: false, // Allow only one file\n      maxFileSize: 5 * 1024 * 1024, // Limit to 5MB\n      keepExtensions: true,\n    });\n\n    // Convert Next.js request into an IncomingMessage stream\n    const incomingReq = await convertNextRequestToIncomingMessage(req);\n\n    const { fields, files }: { fields: Fields; files: Files } =\n      await new Promise((resolve, reject) => {\n        form.parse(incomingReq, (err, fields, files) => {\n          if (err) reject(err);\n          else resolve({ fields, files });\n        });\n      });\n\n    if (!files.file) {\n      return NextResponse.json({ message: \"No file found\" }, { status: 400 });\n    }\n\n    const file = Array.isArray(files.file) ? files.file[0] : files.file;\n    if (!file.filepath) {\n      return NextResponse.json(\n        { message: \"File upload failed\" },\n        { status: 400 }\n      );\n    }\n\n    const oldPath = file.filepath;\n    const fileName = \"hero.png\"; // Replace existing file\n    const uploadDir = path.join(process.cwd(), \"public\"); // Set the upload directory\n    const newPath = path.join(uploadDir, fileName);\n\n    // Move the uploaded file to the public folder\n    await fs.promises.rename(oldPath, newPath);\n\n    return NextResponse.json({\n      message: \"File uploaded successfully!\",\n      filePath: `/public/${fileName}`,\n    });\n  } catch (error) {\n    return NextResponse.json(\n      {\n        message: \"Upload failed\",\n        error: error instanceof Error ? error.message : \"Unknown error\",\n      },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AADA;;;;;;AAKO,MAAM,SAAS;IAAE,KAAK;QAAE,YAAY;IAAM;AAAE;AAEnD,+CAA+C;AAC/C,eAAe,QAAQ,GAAgB;IACrC,MAAM,aAAa,IAAI,OAAO,CAAC,GAAG,CAAC;IACnC,OAAO,eAAe,2BAA2B,mCAAmC;AACtF;AAEA,6EAA6E;AAC7E,eAAe,oCACb,GAAgB;IAEhB,MAAM,cAAc,MAAM,IAAI,WAAW;IACzC,MAAM,SAAS,OAAO,IAAI,CAAC;IAC3B,MAAM,SAAS,IAAI,qGAAA,CAAA,WAAQ;IAC3B,OAAO,IAAI,CAAC;IACZ,OAAO,IAAI,CAAC;IAEZ,OAAO,OAAO,MAAM,CAAC,QAAQ;QAC3B,SAAS,OAAO,WAAW,CAAC,IAAI,OAAO,CAAC,OAAO;QAC/C,QAAQ,IAAI,MAAM;QAClB,KAAK,IAAI,GAAG;IACd;AACF;AAGO,eAAe,KAAK,GAAgB;IACzC,IAAI,CAAE,MAAM,QAAQ,MAAO;QACzB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,SAAS;QAAe,GAAG;YAAE,QAAQ;QAAI;IACtE;IAEA,IAAI;QACF,wCAAwC;QACxC,MAAM,OAAO,IAAI,4LAAA,CAAA,eAAY,CAAC;YAC5B,WAAW;YACX,aAAa,IAAI,OAAO;YACxB,gBAAgB;QAClB;QAEA,yDAAyD;QACzD,MAAM,cAAc,MAAM,oCAAoC;QAE9D,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,GACrB,MAAM,IAAI,QAAQ,CAAC,SAAS;YAC1B,KAAK,KAAK,CAAC,aAAa,CAAC,KAAK,QAAQ;gBACpC,IAAI,KAAK,OAAO;qBACX,QAAQ;oBAAE;oBAAQ;gBAAM;YAC/B;QACF;QAEF,IAAI,CAAC,MAAM,IAAI,EAAE;YACf,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,SAAS;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,MAAM,OAAO,MAAM,OAAO,CAAC,MAAM,IAAI,IAAI,MAAM,IAAI,CAAC,EAAE,GAAG,MAAM,IAAI;QACnE,IAAI,CAAC,KAAK,QAAQ,EAAE;YAClB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;YAAqB,GAChC;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,UAAU,KAAK,QAAQ;QAC7B,MAAM,WAAW,YAAY,wBAAwB;QACrD,MAAM,YAAY,iGAAA,CAAA,UAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,WAAW,2BAA2B;QACjF,MAAM,UAAU,iGAAA,CAAA,UAAI,CAAC,IAAI,CAAC,WAAW;QAErC,8CAA8C;QAC9C,MAAM,6FAAA,CAAA,UAAE,CAAC,QAAQ,CAAC,MAAM,CAAC,SAAS;QAElC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,UAAU,CAAC,QAAQ,EAAE,UAAU;QACjC;IACF,EAAE,OAAO,OAAO;QACd,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAClD,GACA;YAAE,QAAQ;QAAI;IAElB;AACF"}},
    {"offset": {"line": 249, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}